{{>header}}

<main class="container my-5">
    <!--Product image-->
    <div class="row align-items-center">
        <div class="col-md-5 text-center mb-4">
            <img src="/garment/{{garmentId}}/image" alt="{{title}}" class="img-fluid rounded shadow">
        </div>
        <div class="col-md-7">
            <h2>{{title}}</h2>
            <p>{{description}}</p>

            <ul>
                <li><Strong>Category: </Strong>{{category}}</li>
                <li><Strong>Size: </Strong>{{size}}</li>
                <li><Strong>Color: </Strong>{{color}}</li>
                <li><Strong>Fabric: </Strong>{{fabric}}</li>
                <li><Strong>Price: </Strong>{{price}}</li>
            </ul>

            <div class="mt-4">
            <a href="/" class="btn btn-standard" id="backButton">Back</a>

            <a href="/garment/{{garmentId}}/delete" class="btn btn-standard" id="deleteButton">Delete</a>
            <a href="/form/{{garmentId}}" class="btn btn-standard" id="editButton">Edit</a>   
            
           </div>
        </div>
    </div>
    <div class="row mt-4" id="reviewsList">
      <h1>Customer reviews</h1>
      {{#customerReviews}}
      <div class="col-12 p-3 border rounded shadow-sm bg-light mb-4 mt-4" data-review-id="{{reviewId}}">
        <h4>{{username}}</h4>
        <div class="rating">
          {{#arrayRating}}
            {{#.}}
              <i class="bi bi-star-fill text-warning"></i>
            {{/.}}
            {{^.}}
              <i class="bi bi-star text-warning"></i>
            {{/.}}
          {{/arrayRating}}
        </div>
        <p>{{review}}</p>
        <p>Date: {{date}}</p>
        <a class="btn btn-standard delete-review" href="/garment/{{garmentId}}/customerReviews/{{reviewId}}/delete" data-review-id="{{reviewId}}">Delete</a>    
        <a class="btn btn-standard" id="editReviewButton" href="/detail/{{garmentId}}/{{reviewId}}">Edit</a>  
      </div>
      {{/customerReviews}}
    </div>
    <div class="row mt-4">
      {{#edit}}
      <h1>Edit the review:</h1>
      <form role="form" class="p-3 border rounded shadow-sm bg-light mb-4" action="/garment/{{garmentId}}/customerReviews/new/{{newReview.id}}" method="POST" novalidate>
      {{/edit}}
      {{^edit}}
      <h1>Add a review:</h1>
      <form role="form" class="p-3 border rounded shadow-sm bg-light mb-4" action="/garment/{{garmentId}}/customerReviews/new" method="POST" novalidate>
      {{/edit}}

        <div class="form-group mb-3">
          <label for="username" class="form-label"><strong>Username: </strong></label>
          <input class="form-control" id="username" rows="1" placeholder="Write your username here..." name="username" required value="{{newReview.username}}" oninput="checkUserName()">
          <div class="invalid-feedback" id="username-error"></div>
        </div>

        <div class="form-group mb-3">
          <label for="reviewDate" class="form-label"><strong>Date: </strong></label>
          <input type="date" class="form-control" id="reviewDate" rows="1" placeholder="Introduce your date" name="reviewDate" required value="{{newReview.reviewDate}}"onchange="checkDate('reviewDate')">
          <div class="invalid-feedback" id="reviewDate-error">The date cannot be empty.</div>
        </div>

        <div class="form-group mb-3">
          <label for="reviewText" class="form-label"><strong>Review: </strong></label>
          <textarea class="form-control" id="reviewText" rows="5" placeholder="Write your review here..." name="reviewText" required minlength="2" maxlength="100" oninput="checkTextField('reviewText', 'review', errorMessages)">{{newReview.reviewText}}</textarea>
          <div class="invalid-feedback" id="review-error"></div>
        </div>

        <div class="form-group mb-3">
          <label class="form-label"><strong>Rating:</strong></label>
          <div class="rating">
            <input type="radio" id="star5" name="rating" value="1" {{#newReview.is1}}checked{{/newReview.is1}} required>
            <label for="star5">1★</label>

            <input type="radio" id="star4" name="rating" value="2" {{#newReview.is2}}checked{{/newReview.is2}}>
            <label for="star4">2★</label>

            <input type="radio" id="star3" name="rating" value="3" {{#newReview.is3}}checked{{/newReview.is3}}>
            <label for="star3">3★</label>

            <input type="radio" id="star2" name="rating" value="4" {{#newReview.is4}}checked{{/newReview.is4}}>
            <label for="star2">4★</label>

            <input type="radio" id="star1" name="rating" value="5" {{#newReview.is5}}checked{{/newReview.is5}}>
            <label for="star1">5★</label>
          </div>
        </div>

        <button type="submit" class="btn btn-standard">Send</button>

        <div id="review-spinner" class="text-center my-4" style="display: none;">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Processing...</span>
          </div>
        </div>
      </form>

    </div>
    <!-- Review error modal -->
    <div class="modal fade" id="reviewErrorModal" tabindex="-1" aria-labelledby="reviewErrorModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="reviewErrorModalLabel">Form errors</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>The following errors occurred:</p>
            <ul id="review-error-list" class="mb-0"></ul>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    
</main>

{{>footer}}