{{>header}}

  <main class="container my-5">
    
    
    {{#edit}}
      <div class="row my-4">
        <h2 class="text-center">Edit Item</h2>
      </div>
      <form id="productForm" action="/garment/{{garment.id}}/update" method="POST" enctype="multipart/form-data">
    {{/edit}}
    {{^edit}}
      <div class="row my-4">
        <h2 class="text-center">Create Item</h2>
      </div>
      <form id="productForm" action="/garment/new" method="POST" enctype="multipart/form-data">
    {{/edit}}

      <div class="row">

        <div class="col-md-6 col-sm-6">

        <label for="imageFilename" class="form-label">Select Image</label>
        <input type="file" class="form-control mb-5" id="imageFilename" name="image" {{^edit}}required{{/edit}}>

        {{#edit}}
          <div class="mt-3">
            <label class="form-label">Current image:</label>
            <div class="text-center">
              <img src="/garment/{{garment._id}}/image" class="img-fluid rounded shadow-sm" style="max-height: 250px;">
            </div>
          </div>
        {{/edit}}

      </div>


        <div class="col-md-6 col-sm-6">
          <div class="mb-3"> <!--Name-->
            <label for="title" class="form-label">Name of item</label>
            <input type="text" class="form-control" id="title" name="title" value="{{garment.title}}" required pattern="[A-Z].*">
          </div>

          <div class="mb-3"><!--Description-->
            <label for="description" class="form-label">Description of item</label>
            <textarea class="form-control" id="description" name="description" rows="2" required minlength="2" maxlength="100">{{garment.description}}</textarea>
          </div>

          <div class="mb-3"><!--Type-->
            <label for="type">Select type / Category</label>
            <select class="form-select" id="type" name="type" required>
              <option value="" disabled selected>Select type</option>
              <option value="T-Shirt" {{#garment.isT-Shirt}}selected{{/garment.isT-Shirt}}>T-Shirt</option>
              <option value="Jeans" {{#garment.isJeans}}selected{{/garment.isJeans}}>Jeans</option>
              <option value="Trousers" {{#garment.isTrousers}}selected{{/garment.isTrousers}}>Trousers</option>
              <option value="Socks" {{#garment.isSocks}}selected{{/garment.isSocks}}>Socks</option>
              <option value="Cap" {{#garment.isCap}}selected{{/garment.isCap}}>Cap</option>
              <option value="Sweatshirt" {{#garment.isSweatshirt}}selected{{/garment.isSweatshirt}}>Sweatshirt</option>
              <option value="Sneakers" {{#garment.isSneakers}}selected{{/garment.isSneakers}}>Sneakers</option>
            </select>
          </div>

          <div class="mb-3"><!--Size-->
            <label for="size">Select size</label>
            <select class="form-select" id="size" name="size" aria-label="Select size" required>
              <option value="" disabled selected>Select size</option>
              <option value="XS" {{#garment.isXS}}selected{{/garment.isXS}}>XS</option>
              <option value="S" {{#garment.isS}}selected{{/garment.isS}}>S</option>
              <option value="M" {{#garment.isM}}selected{{/garment.isM}}>M</option>
              <option value="L" {{#garment.isL}}selected{{/garment.isL}}>L</option>
              <option value="XL" {{#garment.isXL}}selected{{/garment.isXL}}>XL</option>
            </select>
          </div>

          <div class="mb-3"><!--Color-->
            <label for="color">Select color of item</label>
            <select class="form-select" id="color" name="color" required>
              <option value="" disabled selected>Select color</option>
              <option value="White" {{#garment.isWhite}}selected{{/garment.isWhite}}>White</option>
              <option value="Blue" {{#garment.isBlue}}selected{{/garment.isBlue}}>Blue</option>
              <option value="Dark Blue" {{#garment.isDarkBlue}}selected{{/garment.isDarkBlue}}>Dark Blue</option>
              <option value="Light Blue" {{#garment.isLightBlue}}selected{{/garment.isLightBlue}}>Light Blue</option>
              <option value="Black" {{#garment.isBlack}}selected{{/garment.isBlack}}>Black</option>
              <option value="Orange" {{#garment.isOrange}}selected{{/garment.isOrange}}>Orange</option>
              <option value="Yellow" {{#garment.isYellow}}selected{{/garment.isYellow}}>Yellow</option>
            </select>
          </div>

          <div class="mb-3"><!--Fabric-->
            <label for="fabric">Select fabric of item</label>
            <select class="form-select" id="fabric" name="fabric" required>
              <option value="" disabled selected>Select fabric</option>
              <option value="Cotton" {{#garment.isCotton}}selected{{/garment.isCotton}}>Cotton</option>
              <option value="Wool" {{#garment.isWool}}selected{{/garment.isWool}}>Wool</option>
              <option value="Leather" {{#garment.isLeather}}selected{{/garment.isLeather}}>Leather</option>
              <option value="Silk" {{#garment.isSilk}}selected{{/garment.isSilk}}>Silk</option>
              <option value="Synthetic" {{#garment.isSynthetic}}selected{{/garment.isSynthetic}}>Synthetic</option>
            </select>
          </div>

          <div class="mb-3"><!--Price-->
            <label for="price" class="form-label"> Price of item of clothing (â‚¬)</label>
            <input type="number" step="0.01" class="form-control" id="price" name="price" value="{{garment.price}}" placeholder="0.00" min="0.01" required>
          </div>

        </div>
      </div>
      <div class="row my-4">
        <div class="container mt-3 col-md-6 col-sm-6 col-xs-6">
          <button type="submit" class="btn btn-primary col-md-12 col-sm-12 col-xs-12" id="submitBtn">Save changes</button>
        </div>
        <div class="container mt-3 col-md-6 col-sm-6">
          {{#edit}}
            <a href="/detail/{{garment.id}}" class="btn btn-primary col-md-12 col-sm-12 col-xs-12">Cancel</a>
          {{/edit}}
          {{^edit}}
            <a class="btn btn-primary col-md-12 col-sm-12 col-xs-12" href="/">Cancel</a>
          {{/edit}}

        </div>
      </div> 

    </form>

  </main>
    
<script>
  const form = document.getElementById('productForm');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const submitBtn = document.getElementById('submitBtn');
    const originalText = submitBtn.textContent;

    submitBtn.disabled = true;
    submitBtn.textContent = 'Saving...';

    try {
      const response = await fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
      });

      const data = await response.json();

      if (data && data.location) {
        window.location.href = data.location;
        return;
      }

      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
    } catch (error) {
      console.error('Error sending form:', error);
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
    }
  });
</script>

{{>footer}}